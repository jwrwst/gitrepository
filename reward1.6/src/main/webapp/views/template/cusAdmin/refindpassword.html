[#include "model/header-unmenu.html"]
<meta charset="utf-8" />
	<style type='text/css'>
	body {
		overflow-x: hidden;
	}
	.navbar .nav.pull-right{ display:none;}
	.step span {
			display: inline-block;
			line-height: 25px;
			float:left; 
			width:25%;
		}
		
		.step span i {
			background: #f5f5f5;
			width: 25px;
			height: 25px;
			display: inline-block;
			border-radius: 25px;
			margin-right: 10px;
			text-align: center;
			font-style: normal;
		}
		
		.step span.active {
			color: #33CC66;
		}
		
		.step span.active i {
			background: #33CC66;
			color: #fff;
		}
		#spanRandomCade{ margin-top:10px; color:#e02222;}
	</style>


<div class="row-fluid">
	<div class="span12">
		<div class="portlet-body form"
			style='width: 600px; margin: 45px auto;'>
			<form action="#" id="queryForm" class="form-horizontal form-row-seperated">
				<h3 class="form-section merchantsdis">找回密码</h3>
				<div class="control-group step">
					<span class='active' id="first"><i>1</i>安全验证</span>
					<span id="second"><i>2</i>验证身份</span>
					<span id="third"><i>3</i>设置新密码</span>
					<span id="four"><i>4</i>完成</span>
				</div>
				<div class="control-group">

					<label class="control-label" for="orgName">手机号</label>

					<div class="controls">

						<input type="text" name="phone" class="m-wrap span12"
							placeholder="请输入商户绑定的手机号码">

					</div>

				</div>
				<div class="control-group">

					<label class="control-label" for="orgName">验证码</label>

					<div class="controls">

						<input type="text" name="verificationCode" class="m-wrap span12"
							style='width: 50%; float: left;' placeholder="请输入验证码" id="randomCodeInput" maxlength="4">
						<img src="" style='width: 90px; float: left; margin: 0 5px; height: 32px;' id="randomCodeImg"/>
						<a style='height: 34px; line-height: 34px;' href="#" onclick="clickChangeImg()">看不清楚？换一张</a>
						
						<!-- 添加错误提示信息 -->
						<div id="spanRandomCade" class="errorMessage"></div>
					</div>

				</div>


				<div class="form-actions">

					<button type="button" class="btn blue" onclick="nextRefindPassword()">下一步</button>

					<button type="button" class="btn gray" onclick="window.history.go(-1)">取消</button>
				</div>

			</form>
		</div>


	</div>

</div>

[#include "model/footer-unmenu.html"]
</body>
<script type="text/javascript">
	var contentPath=App.path;
	$(function(){
		clickChangeImg();
	});
	//切换验证码
	function clickChangeImg(){
		$("#randomCodeImg").attr("src",contentPath+"/rs/external/merchants/wap/randomCode?v=" + Math.random());
	}
	function validateVerificationCode(){
		var randomCodeCheck=/^[0-9a-zA-Z]{4}$/;
		if (!randomCodeCheck.test($("#randomCodeInput").val())) {
			$("#spanRandomCade").html("验证码长度必须为4位,并且不能为空！");
			$("#randomCodeInput").focus();
			return false;
		}else{
			$("#spanRandomCade").css("color","green");
			//$("#spanRandomCade").html("密码格式无误");
		}
		return true;
	}
	//进入下一步
	function nextRefindPassword(){
		//验证验证码格式
		if(!validateVerificationCode()){
			return false;
		}
		var param=$("#queryForm").serializeJson();
		var phone = param.phone;
		if(phone.length<11){
			$.alert("请输入正确的手机号!");
			return false;
		}
		var verificationCode=param.verificationCode;
		var params="phone="+phone+"&verificationCode="+verificationCode;
		var url=App.path+"/rs/external/merchants/wap/nextRefindPassword?v="+Math.random();
		$.ajax({
			// 后台处理程序
			url : url,
			// 数据发送方式
			type : "get",
			// 接受数据格式
			dataType : "json",
			// 要传递的数据
			data : params,
			// 回传函数
			success : function(data){
				//跳转到下一个页面
				//console.log(data);
				var successCode=data.resultMessage.messageCode;
				if(successCode=="0000"){
					window.localStorage.setItem("phone", phone);
					window.localStorage.setItem("randomCodeInput", $("#randomCodeInput").val());
					window.location.href="wap-refindpassword2.xhtml";
				}else{
					var errorMsg=data.resultMessage.messageText;
					clickChangeImg();
					$("#spanRandomCade").html(errorMsg);
				}
			}
		});
	}
	
</script>
</html>


