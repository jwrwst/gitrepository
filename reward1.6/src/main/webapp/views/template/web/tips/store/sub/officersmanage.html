<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>众赏</title>
<link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css"
	rel="stylesheet" />
<link href="${basepath}/assets/def/css/tips.css" rel="stylesheet" />
<link rel="shortcut icon" href="${basepath}/assets/favicon.ico" />
</head>

<body>
	<!--页面主结构开始-->
	<div id="center" class="mui-views">
		<div class="mui-view">
			<div class="mui-navbar"></div>
			<div class="mui-pages"></div>
		</div>
	</div>

	<div id="regpage" class="mui-page">
		<!--页面标题栏开始-->
		<div class="mui-navbar-inner mui-bar mui-bar-nav">
			<h1 class="mui-center mui-title" style="font-weight: bold;">人员管理</h1>
		</div>
		<div class="mui-page-content" id="scroll-content">
			<div class="mui-padded">
				<div class="plat-content">
					<div class="plat-subtitle">管理层</div>
					<ul class="mui-table-view">
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								区域经理 </a></li>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								店长 </a></li>
					</ul>
					<div class="plat-subtitle">店员</div>
					<ul class="mui-table-view" style='margin-bottom:80px;'>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								参与分成人员 <br /><font style='color:#999;'>在后台工作，不常接触顾客的店员</font> </a></li>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								服务员 <br /><font style='color:#999;'>常接触顾客，可被打赏的店员 </font></a></li>
<li class="mui-table-view-cell"><a class="mui-navigate-right">
								参与分成人员 <br /><font style='color:#999;'>在后台工作，不常接触顾客的店员</font> </a></li>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								服务员 <br /><font style='color:#999;'>常接触顾客，可被打赏的店员 </font></a></li>
<li class="mui-table-view-cell"><a class="mui-navigate-right">
								参与分成人员 <br /><font style='color:#999;'>在后台工作，不常接触顾客的店员</font> </a></li>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								服务员 <br /><font style='color:#999;'>常接触顾客，可被打赏的店员 </font></a></li>
<li class="mui-table-view-cell"><a class="mui-navigate-right">
								参与分成人员 <br /><font style='color:#999;'>在后台工作，不常接触顾客的店员</font> </a></li>
						<li class="mui-table-view-cell"><a class="mui-navigate-right">
								服务员 <br /><font style='color:#999;'>常接触顾客，可被打赏的店员 </font></a></li>
					</ul>

				</div>

				<!-- 页面底部标题 -->
			</div>
		</div>
	</div>

	[#include '../model/menu.html']
</body>

<script src="${basepath}/assets/plugin/require.js"></script>
<script type="text/javascript"
	src="${basepath}/assets/def/js/tips/tips.js"></script>
<script type="text/javascript">
	  require(["jquery","mui","mui_view","addr","common","jweixin"],function($$,M,mui_view,addr,tools,wx){
		  var storeId = window.localStorage.getItem("storeId");
		  var empId = window.localStorage.getItem("empId");
		  $$("#storeId").val(storeId);
		  $$("#updateUser").val(empId);
		  //初始化单页view
		  var viewApi = mui('#center').view({
		  	defaultPage: '#regpage'
		  });
		  
		  $$(document).ready(function(){
			  //初始化微信
			  try{tools.initWeiXin(addr);}catch(e){console.log(e);}
			  //扫一扫获取商户
			  mui('body').on('tap','#orgName',function(){
				  wx.scanQRCode({
					    needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
					    scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
					    success: function (res) {
					     	var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
					     	addr.getRegisterMerchantsEntity("orgCode="+result+"&openId=-1",function(data){
								 if(data!=null&&data.resultMessage.messageCode=="0000"){
									 var json= data.resultData.body.result;
									 if(json.length>0){
										 $$("input[name='orgCode']").val(result);
										 $$("#orgName").val(json[0].merName);
									 }else{
										 tools.toast(null,"商户不存在");
									 }
									 
								 }else{
									 tools.toast(null,"商户不存在");
								 }
							}); 
					     	
					     	
					    }
				  });
			  });

			  //获取店铺信息
			  addr.getStore("storeId="+storeId, function(data){
				  
				  if(data!=null&&data.resultMessage.messageCode=="0000"){
					  var json= data.resultData.body.result;
					  $$("input[name='storeName']").val(json.storeName);
					  
					  //获取开启功能列表
				      var authcode=(json.authlist!=null&&json.authlist.length!=0)?json.authlist[0].authCode:"0";
					  addr.getStoreAuth("groupCode=001",function(data){
						  var list = data.resultData.body.result;
						  var strHtml=[];
						  for(var i=0;i<list.length;i++){
							  if(list[i].authCode == authcode){
								  strHtml.push("<option value='"+list[i].authCode+"' selected='selected'>"+list[i].authName+"</option>");
							  }else{
							  	  strHtml.push("<option value='"+list[i].authCode+"'>"+list[i].authName+"</option>");
							  }
						  }
						  $$("#authType").html("");
						  $$("#authType").html(strHtml.join(""));
					  });
					  
					 //加载上级权限
					 if(json.storeCode!='0'&& json.storeCode!=""){
						 addr.getRegisterMerchantsEntity("orgCode="+json.storeCode+"&openId=-1",function(data){
							 if(data!=null&&data.resultMessage.messageCode=="0000"){
								 var json= data.resultData.body.result;
								 if(json.length>0){
									 $$("input[name='orgCode']").val(json.storeCode);
									 $$("#orgName").val(json[0].merName);
								 }
								 
							 }
						 }); 
					 }
					 
				  }
			  });
		  });
	  
	 
	
		  mui('.mui-content-padded').on('tap','#regbnt',function(e) {
			    var data = $$("#storeInfo").serializeJson();
			    if($$("input[name='storeName']").val()=="" || $$("input[name='storeName']").val()==null){
			    	tools.toastTip("","请输入店铺名称");
			    	return;
			    }
			    data.storeCode = data.orgCode;
				var datastr=JSON.stringify(data);
				var _this =this;
				addr.editStore(datastr,function(resdata){
					if(resdata&&resdata.resultMessage.messageCode=="0000"){
						tools.toast(null,"修改成功");
						//调用父级操作
					 	window.localStorage.setItem("authCode", $$("#authType").val());
					 	authFunc();
					 	
					}else{
						tools.toast("错误","修改失败");
					};
				});
				
		  });	  
	  
	  });

	  

	  </script>
</html>
