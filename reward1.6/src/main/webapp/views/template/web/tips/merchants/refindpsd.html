<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>找回密码</title>
<link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css"
	rel="stylesheet" />
<link href="${basepath}/assets/def/css/tips.css" rel="stylesheet" />
<style>
	html,body {
		margin: 0;
		overflow-x: hidden;
	}
	
	.mui-bar a.mui-icon,.mui-bar .mui-icon:active {
		color: #EA4F16;
		opacity: 1;
	}
	#spanRandomCade{ margin-top:10px; color:#e02222;}
</style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">找回密码</h1>
	</header>
	<!--页面主结构开始-->
	<div class="mui-content">
		<form class="mui-input-group" style="margin-top: 10px;" id="queryForm">
			<div class="mui-input-row">
			    <label>手机号</label> 
				<input type="text" class="" readonly="readonly" placeholder="请输入绑定的手机号" name="mobile" id="mobile" maxlength="13">
			</div>
			<div class="mui-input-row">
				<label style='width:25%;'>验证码</label> 
				<i style='float:right;padding:15px;' class='mui-icon iconfont icon-store-refresh' onclick="clickChangeImg()"></i>
				<img src="" style='width:20%; margin-top:8px; float:right; max-height:34px;' id="randomCodeImg">
				<input style='width:35%;' type="text" placeholder="请输入验证码" name="verificationCode" id="verificationCode">
				<!-- 添加错误提示信息 -->
				<div id="spanRandomCode" class="errorMessage"></div>
			</div>
			
		</form>
		<!-- 
		<p class="mui-table-view-cell">
			<a style="color: #EA4F16; float:right;" href="#">修改密码</a> 密码长度6-20个字符
		</p>
		 -->
	</div>


	<div class="tips-reginfo-submit"
		style="position: absolute; left: 10px; bottom: 20px; right: 10px;">
		<button type="button" class="mui-btn mui-btn-warning mui-btn-block" id="affirm">下一步</button>
	</div>



</body>
<script src="${basepath}/assets/plugin/require.js"></script>
<script type="text/javascript" src="${basepath}/assets/def/js/tips/tips.js"></script>
<script type="text/javascript">
	var RefindPsd = {
		init:function(){
			require([ "jquery", "mui", "mui_view", "addr", "common","ftscroller"],
					function($$, mui, mui_view, addr, tools) {

				$(function(){
					clickChangeImg();
					var mobile  = localStorage.getItem("mobile");
					$("#mobile").val(mobile);
				});
				function clickChangeImg(){
					$("#randomCodeImg").attr("src",addr.com.randomCode);
				}
				//前端校验
				function validateVerificationCode(){
					var randomCodeCheck=/^[0-9a-zA-Z]{4}$/;
					if (!randomCodeCheck.test($("#verificationCode").val())) {
						//$("#spanRandomCode").html("验证码长度必须为4位,并且不能为空！");
						tools.toastTip("错误","验证码长度必须为4位,并且不能为空！");
						$("#verificationCode").focus();
						return false;
					}else{
						$("#spanRandomCode").css("color","green");
						//$("#spanRandomCode").html("密码格式无误");
					}
					return true;
				}
				
				$("#affirm").click(function(){
					//验证验证码格式
					if(!validateVerificationCode()){
						return false;
					}
					var phone = $("#mobile").val();
					if(phone.length<11){
						//$("#spanRandomCode").html("请输入正确的手机号!");
						tools.toastTip("错误","请输入正确的手机号!");
						return false;
					}
					var verificationCode=$("#verificationCode").val();
					var params="phone="+phone+"&verificationCode="+verificationCode;
					var url=addr.mercants.nextRefindPassword;
					$.ajax({
						// 后台处理程序
						url : url,
						// 数据发送方式
						type : "get",
						// 接受数据格式
						dataType : "json",
						// 要传递的数据
						data : params,
						// 回传函数
						success : function(data){
							//跳转到下一个页面
							//console.log(data);
							var successCode=data.resultMessage.messageCode;
							if(successCode=="0000"){
								window.localStorage.setItem("phone", phone);
								window.localStorage.setItem("randomCodeInput", $("#verificationCode").val());
								window.location.href="tips_merchants_refindpsd2.xhtml";
							}else{
								var errorMsg=data.resultMessage.messageText;
								//$("#spanRandomCade").html(errorMsg);
								tools.toastTip("错误",errorMsg);
							}
						}
					});
				});
			});
		}
	}
	RefindPsd.init();
	
</script>
</html>