<!DOCTYPE html>
<html>
	  <head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <title>众赏</title>
	    <link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css" rel="stylesheet"/>
	    <link href="${basepath}/assets/def/css/tips.css" rel="stylesheet"/>
	    <link rel="shortcut icon" href="${basepath}/assets/favicon.ico" />
	  </head>
	  
	  <body> 	  	
	    <!--页面主结构开始-->
		<div id="center" class="mui-views">
			<div class="mui-view">	
			    <div class="mui-navbar" style="display: none;">
				</div>	
				<div class="mui-pages">
				</div>
			</div>
		</div>
		
		<div id="welcomepage"  class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav" style="display:none;">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>
				</button>
				<h1 class="mui-text-left mui-title"></h1>
			</div>
		
			<div class="mui-page-content"  id="scroll-content">		
			<a href="#resultpage" id="rega" style="display:none;"></a>		
				<div class="plat-content">
				   <div class="mui-content">
					<div style="margin:50px;text-align: center;">
					  <p style="font-size:1.3em;color:#EA4F16;margin-bottom:30px;">您还没有注册为商家哦！</p>
					</div>
					<div>
						<div class="mui-content-padded tips-reginfo-submit" >		        
					        <button  type="button" class="mui-btn mui-btn-warning mui-btn-block" id="regMain" >免费开通打赏</button>	
					        				        	       
					    </div>
					</div>					
					
				   </div>
				</div>
				<div class="plat-title mui-text-center">
						打赏平台
				</div>
			</div>
		</div>
	     
		<div id="regpage" class="mui-page" >
		  <!--页面标题栏开始-->
		  <div class="mui-navbar-inner mui-bar mui-bar-nav">				
				<h1 class="mui-text-left mui-title"  style="font-weight:bold;margin-left:-24px;">开通打赏</h1>
		  </div>
		  <div class="mui-page-content"  id="scroll-content_detail">
		  <div class="scroller">
		  		<a href="#resultpage" id="rega" style="display:none;"></a>
		  	     <div class="plat-content">
				     <form name = "storeInfo" id="storeInfo">						
						<div class="mui-input-group">
							<div class="mui-input-row">
								<label>您的姓名</label>
								<input type="text"  class="mui-input-clear" placeholder="请输入您的全名" name="createUser" maxlength="50">
							</div>
							<div class="mui-input-row">
								<label>手机号</label>
								<input type="text" class="mui-input-clear" placeholder="请输入您的手机号" name="createMobile" maxlength="20">
							</div>						
						</div>
						<div class="plat-subtitle">
							店铺信息
						</div>
						<div class="mui-input-group">
							<div class="mui-input-row">
								<label>名称</label>
								<input type="text" class="mui-input-clear" placeholder="请输入店铺名称" name="storeName" maxlength="100">
							</div>
							<div class="mui-input-row">
								<label>商户代码</label>
								<input type="text" class="mui-input-clear" placeholder="请输入商户代码" name="orgCode" maxlength="100">
							</div>
							<div class="mui-input-row">
									<label id="System.store.type">分类</label>
									<span class="mui-icon  iconfont icon-up" style="right:0px;font-size:12px !important;"></span>								
									<select class="mui-btn mui-btn-block" style="width:50%;background: transparent;padding-right:20px;text-align: center;"  name="storeType" id="storeType">									
									</select>							
							</div>
							<div class="mui-input-row">
								<label>地址</label>
								<input type="text"  class="mui-input-clear" placeholder="请输入店铺地址" name="address" maxlength="100">
							</div>
							<div class="mui-input-row">
								<label>电话</label>
								<input type="text" class="mui-input-clear" placeholder="区号+固定号码" name="telphone" maxlength="30">
							</div>						
						</div>
						
						<div>
							<div class="mui-content-padded tips-reginfo-submit" >
							    <input type="hidden" name="create_openId" value="${loginVo.openId}">	
							    <input type="hidden" name="nickname" value="${loginVo.nickname}">
							    <input type="hidden" name="sex" value="${loginVo.sex}">
							    <input type="hidden" name="province" value="${loginVo.province}">
							    <input type="hidden" name="city" value="${loginVo.city}">	
							    <input type="hidden" name="country" value="${loginVo.country}">
							    <input type="hidden" name="headimgurl" value="${loginVo.headimgurl}">		        
						        <button  type="button" class="mui-btn mui-btn-warning mui-btn-block" id="regbnt">注册</button>					        	     
						    </div>
						      
						</div>
				
		
					</form>
			    </div>
				
			  </div>
             </div>
		</div>
			
		<div id="resultpage"  class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav" style="display:none;">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>
				</button>
				<h1 class="mui-text-left mui-title">注册成功</h1>
			</div>
		
			<div class="mui-page-content">
			  <div class="scroller">
			  
				<div class="plat-content">
				   <div class="mui-content">
				     <div style="text-align: center;height:120px;padding:10px; ">
						<div style="width:100%;float: left;text-align: center;"><img alt="" src="${basepath}/assets/def/images/success.png" class="successImg"></div>
						<div style="width:100%;float: left;text-align: center;font-weight:bold;padding:10px 10px;">
							<p style="font-size:1.2em;color:#EA4F16;margin-bottom:30px;">您的店铺已开通成功!<br>请长按下方二维码，关注众赏公众号</p>
						</div>
						<div style="width:100%;float: left;text-align: center;"><img alt="" src="${basepath}/assets/def/images/qrcode_weixin.jpg" style="width:40%"></div>
                    </div>
					
					<div style="display:none;">
						<div class="mui-content-padded tips-reginfo-submit" >		        
					        <button  type="button" class="mui-btn mui-btn-warning mui-btn-block" id="comeMain" >进入店铺首页</button>					        	       
					    </div>
					</div>					
					
				  </div>
				</div>
				
			 <div class="scroller">
			</div>
		</div>
			

		
	  </body>
	  
	  <script src="${basepath}/assets/plugin/require.js"></script>
	  <script type="text/javascript" src="${basepath}/assets/def/js/tips/tips.js"></script>
	  <script type="text/javascript">
	  var state="${loginVo.state}";
	  require(["jquery","mui","mui_view","addr","common"],function($$,mui,mui_view,addr,tools){
		  //初始化单页view
		  if(state==4){
			  var viewApi = mui('#center').view({
			  	defaultPage: '#regpage'
			  });
		  }else{
			  var viewApi = mui('#center').view({
			  	defaultPage: '#welcomepage'
			  });
		  }
		  
		  $$(document).ready(function(){
			  addr.getClassType("codeClass=System.store.type", function(data){
				  if(data&&data.resultMessage.messageCode=="0000"){
					  var list = data.resultData.body.result;
					  var strHtml=[];
					  for(var i=0;i<list.length;i++){
						  strHtml.push("<option value='"+list[i].value+"'>"+list[i].name+"</option>")
					  }
					  $$("#storeType").html("");
					  $$("#storeType").html(strHtml.join(""));
				  }
			  });			  
			  
			  
		  });
		  
	
		  var flag=true;
		  mui('.mui-content-padded').on('tap','#regbnt',function(e) {
			    if(flag==false){
			    	return;			    	
			    }
			    flag = false;
			    
			    var data = $$("#storeInfo").serializeJson();				
				var _this =this;
				if(data.storeName==""){
					tools.toastTip(null,"请输入店铺名称");
					return;
				}	
				data.nickname=data.createUser;
				var datastr=JSON.stringify(data);
				addr.saveStore(datastr,function(data){
					flag=true;
					if(data!=null&&data.resultMessage.messageCode=="0000"){
// 						$$("#center").find(".mui-navbar").hide();
// 						$$("#rega").attr("href","#resultpage");
// 						mui.trigger(document.getElementById("rega"),'tap');	
						window.location.href="${basepath}/views/template/web/tips_store_reg-success.xhtml"
						//window.history.pushState({page:"pagedetails"}, "page", window.location.href);
					}else{
						tools.toast("错误","注册失败,请直接联系众赏或再试一次.");
					}
				});
				
		  });	  
		  
		  
		  mui('.mui-content-padded').on('tap','#comeMain',function(e) {
			   window.location.href = '${basepath}/storelogin.xhtml?state='+state;		  
	      });
		  
		  mui('.mui-content-padded').on('tap','#regMain',function(e) {
			  $$("#center").find(".mui-navbar").show();
			  document.getElementById("rega").href="#regpage";
			  mui.trigger(document.getElementById("rega"),'tap');	
			  
			//加载滚动
			  tools.scrollBar(document.getElementById('scroll-content_detail'),null);
			  
			  //window.history.pushState({page:"pagedetails"}, "page", window.location.href);
	      });
	  
	  });
	  </script>
</html>			