<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.rp.services.sys.core.dao.SysCodeInfoDAO">
    
    <resultMap id="sysCodeInfoEntityMap" type="com.platform.rp.services.sys.core.dao.entity.SysCodeInfoEntity">
        <id column="id" property="id" />
        <result column="classifyid" property="classifyid" />
		<result column="name" property="name" />
		<result column="value" property="value" />
		<result column="useable" property="useable" />
		<result column="sorter" property="sorter" />
		<result column="description" property="description" />
		<result column="updatedtime" property="updatedtime" />
    </resultMap>
    
    <resultMap id="sysCodeInfoVoMap" type="com.platform.rp.services.sys.inner.vo.SysCodeInfoVo">
        <id column="id" property="id" />
        <result column="classifyid" property="classifyid" />
		<result column="name" property="name" />
		<result column="value" property="value" />
		<result column="useable" property="useable" />
		<result column="sorter" property="sorter" />
		<result column="description" property="description" />
		<result column="updatedtime" property="updatedtime" />
		<result column="classname" property="classname" />
		<result column="classcode" property="classcode" />
    </resultMap>
    
    <sql id="page">
        <if test="start > -1">
            <if test="end > 0">
                limit #{start}, #{end}
            </if>
        </if>
    </sql>
    
    <sql id="selectColumn">
        id,classifyid,name,value,useable,sorter,description,updatedtime
    </sql>
    
    <insert id="save" parameterType="com.platform.rp.services.sys.core.dao.entity.SysCodeInfoEntity" useGeneratedKeys="true" keyProperty="id">
        insert into sys_code_info(name,classifyid,value,useable,sorter,description)
        values(#{name},#{classifyid},#{value},#{useable},#{sorter},#{description})
    </insert>
    
    <update id="update" parameterType="com.platform.rp.services.sys.core.dao.entity.SysCodeInfoEntity">
        update sys_code_info
        <set>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="value != null">
                value = #{value},
            </if>
            <if test="useable != null">
                useable = #{useable},
            </if>
            <if test="sorter != null">
                sorter = #{sorter},
            </if>
            <if test="description != null">
                description = #{description},
            </if>
        </set>
        where id = #{id}
    </update>
    
    <select id="get" resultType="com.platform.rp.services.sys.core.dao.entity.SysCodeInfoEntity" parameterType="int">
		select
		<include refid="selectColumn" />
		from sys_code_info where id = #{id}
	</select>
	
    <delete id="delete" parameterType="int">
		delete from sys_code_info where id = #{id}
	</delete>
    
	<select id="getListPage" resultMap="sysCodeInfoEntityMap" parameterType="com.platform.rp.services.sys.core.dao.entity.SysCodeInfoEntity">
		select
		<include refid="selectColumn" />
		from sys_code_info
		where 1 = 1
		<if test="name != null">
		    and instr(name, #{name}) > 0
		</if>
		<if test="classifyid > 0">
		    and classifyid = #{classifyid}
		</if>
		order by sorter
		<include refid="page" />
	</select>
	
	<select id="getByClassvalue" resultMap="sysCodeInfoVoMap" parameterType="string">
	    select cls.name classname, cls.value classvalue, code.* from sys_code_class cls, sys_code_info code
	    where cls.value = #{classvalue}
	    and cls.useable = 1
	    and cls.id = code.classifyid
	    and code.useable = 1
	    order by sorter
	</select>

	<select id="getByInfovalue" resultMap="sysCodeInfoVoMap"
		parameterType="com.platform.rp.services.sys.inner.vo.SysCodeInfoVo">
		select cls.name classname, cls.value classvalue, code.* 
		from sys_code_class cls, sys_code_info code
		where 1=1
		and code.name = #{name}
		and cls.value = #{classvalue}
		and cls.useable = 1
		and cls.id = code.classifyid
		and code.useable = 1
		order by sorter
	</select>

	<select id="findSysCodeByClassAndCodeValue" resultMap="sysCodeInfoVoMap" 
		parameterType="com.platform.rp.services.sys.inner.vo.SysCodeInfoVo">
		select cls.name classname, cls.value classvalue, co.* 
		from sys_code_class cls, sys_code_info co
		where 1=1
		and co.value = #{codeValue}
		and cls.value = #{codeClass}
		and cls.useable = 1
		and cls.id = co.classifyid
		and co.useable = 1
		order by sorter
	</select>
	
<!-- 	
	<select id="getListByParentId" resultMap="sysCodeInfoEntityMap" parameterType="string">
		select
		<include refid="selectColumn" />
		from sys_code_info
		where 1 = 1
		<if test="name != null">
		    and instr(name, #{name}) > 0
		</if>
		<if test="classifyid > 0">
		    and classifyid = #{classifyid}
		</if>
		order by sorter
		<include refid="page" />
	</select> -->
	<select id="getCodeInfoByParentId" resultMap="sysCodeInfoEntityMap" parameterType="string">
		select
		<include refid="selectColumn" />
		from sys_code_info
		where useable = 1
		<if test="name != null">
		    and instr(name, #{name}) > 0
		</if>
		<if test="classifyid > 0">
		    and classifyid = #{classifyid}
		</if>
		order by sorter
		<include refid="page" />
	</select>
	
	
	<select id="getListByParentCode" resultMap="sysCodeInfoEntityMap" parameterType="string">
		select *
		from sys_code_info
		where useable = 1
		<if test="parCode != null">and parent_code = #{parCode}</if>
		order by sorter
	</select>
</mapper>