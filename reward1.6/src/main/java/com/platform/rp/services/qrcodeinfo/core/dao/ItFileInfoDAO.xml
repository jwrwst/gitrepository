<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.rp.services.qrcodeinfo.core.dao.ItFileInfoDAO">
    
    <resultMap type="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItFileInfoEntity" id="itFileInfoEntity">
		<result column="store_id" property="storeId" />
		<result column="store_name" property="storeName" />
		<result column="emp_id" property="empId" />
		<result column="state" property="state" />
		<result column="order_num" property="orderNum" />
		<result column="gnum" property="gnum" />
		<result column="file_url" property="fileUrl" />
		<result column="created_time" property="createdTime" />
		<result column="update_time" property="updateTime" />
    </resultMap>
    
    <insert id="save" parameterType="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItFileInfoEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO it_file_info (emp_id,store_id,file_url,order_num,gnum,state,created_time,update_time)
        VALUES (#{empId}, #{storeId},#{fileUrl}, #{orderNum},#{gnum},#{state},#{createdTime},#{updateTime})

    </insert>
    
    <update id="update" parameterType="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItFileInfoEntity">
        update it_file_info 
        <set>
            <if test="state != 0 and state !=null">
                state = #{state},
            </if>
            <if test="updateTime !='' and updateTime !=null">
                update_time = #{updateTime},
            </if>
        </set>
        where id = #{id}
      
    </update>
    
    <select id="getByOrderNum"  resultMap="itFileInfoEntity" parameterType="string">
        select s.*,b.store_name from it_file_info s left join bs_store_info b on s.store_id =  b.store_id  where order_num = #{orderNum}        
    </select>

    <select id="getList" resultMap="itFileInfoEntity" parameterType="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItFileInfoEntity">        
        select * from it_file_info 
        <where>
            1=1
            <if test="state != 0 and state !=null">
               and state = #{state}
            </if>
            <if test="updateTime !='' and updateTime !=null">
               and DATE_FORMAT(update_time,'%Y-%m-%d %H') = DATE_FORMAT(#{updateTime},'%Y-%m-%d %H')
            </if>
            <if test="createdTime !='' and createdTime !=null">
               and DATE_FORMAT(created_time,'%Y-%m-%d %H') = DATE_FORMAT(#{createdTime},'%Y-%m-%d %H')
            </if>
            <if test="storeId !=0 and storeId !=null">
               and store_id = #{storeId}
            </if>
             <if test="empId !=0 and empId !=null">
               and emp_id = #{empId}
            </if>
            <if test="gnum !=0 and gnum !=null">
               and gnum = #{gnum}
            </if>
        </where>
    </select>

</mapper>