<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>区域管理</title>
<link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css"
	rel="stylesheet" />
<link href="${basepath}/assets/def/css/tips.css?v=9432424234234384aabb" rel="stylesheet" />
<link href="${basepath}/assets/plugin/mui/dist/css/mui.picker.css" rel="stylesheet" />
<link href="${basepath}/assets/plugin/mui/dist/css/mui.poppicker.css" rel="stylesheet" />
<style>
	body{
		background-color: #F6F1EE;
		width: 100%;
		height:100%;
	}
	.header .img {
	    background: url("/assets/def/images/tenant.png") no-repeat center center;
	    width: 100%;
	    min-height: 150px;
	    display: block;
	    background-size: 150px auto;
	}
	.mui-table-view-cell:after{
		height: 0;
	}
	/* .mui-navigate-right{
		margin-left: 15px;
		border-bottom: 1px solid #eaeaea;
	} */
	.mui-table-view-cell{
		padding-left: 0;
		border-bottom: 1px solid #eaeaea;
	}
	.mui-content{
		background-color: #F6F1EE;
	}
	.mui-checkbox input[type=checkbox]:checked:before, .mui-radio input[type=radio]:checked:before {
   	    color: #EA4F16;
	}
	.changepage{
		display: none;
	}
	.mui-content>.mui-table-view:first-child {
        margin-top: 0;
	}
	.mui-table-view>li>a:not(.mui-btn){
		margin: -11px 15px;
	}
	.mui-checkbox input[type=checkbox]:before,.mui-checkbox input[type=checkbox]:checked:before
	{
		content: none;
	}

	.mui-checkbox input[type=checkbox] {
		background: url("${basepath}/assets/def/images/edit1.png") no-repeat
			left center;
		background-size: 20px;
	}
	
	.mui-checkbox input[type=checkbox]:checked {
		background: url("${basepath}/assets/def/images/edit1.png") no-repeat left
			center;
		background-size: 20px;
	}
	
	.mui-checkbox .check_box_checked {
		background: url("${basepath}/assets/def/images/edit.png") no-repeat
			left center !important;
		background-size: 20px !important;;
	}
	
	.active{
		color:  #ea4f16;
	}
	
	#tab2{
		padding-bottom:30px;
	}
	
	.mui-btn-gray{
		background-color: lightgray;
	}
	.store_name_status_edit{
		float: right;
   		padding-right: 33px;
   		color: #EA4F16;
	}
	.store_name_status{
		float: right;
   		padding-right: 33px;
   		color: lightgray;
	}
	.mui-table-view{margin-bottom: 45px}
	.mui-table-view li{position:relative;}
	.mui-table-view>li>a:not(.mui-btn){width:100%;}
	.mui-table-view li span.store_name_status_edit{ padding-right:18px;}
    .mui-table-view li span.store_name_status,.mui-table-view li span.store_name_status_edit{position:absolute; display:block; overflow:hidden; right:0; top:10px;z-index:9;}
</style>
</head>
<body style="display: none">
	<header class="mui-bar mui-bar-nav">
		<span class="mui-pull-right"> <span
			class="mui-icon iconfont icon-up"
			style="position: absolute; left: 115px; top: 6px; color: #cccccc; font-size: 12px !important;"></span>
			<select class="mui-btn mui-btn-block mui-pull-right"
			style="max-width: 105px; background: transparent; display:block; position: absolute; left: 0;"
			name="dateType" id="merchantsInfo">
		</select>
		</span>
		<!-- <p style="float:right; font-size: 14px;line-height: 44px;color: #EA4F16;" id="userInfo">账户与安全</p> -->
	</header>
	<div style="margin-top: 50px;position: relative;" >
		<!-- tab1 start -->
		<div id="tab1" >
		<div style="width:100%; position:fixed; height: 85px; top:46px; background:#F6F1EE; z-index:999;">
			<div style="width: 100%;height: 50px;border-bottom: 1px solid #e2dfdf;">
				<input type="text" class="" placeholder="搜索" name="storeaddress" maxlength="100"  id="searchVal"
				style="text-indent: 25px;margin-left: 5%;text-align:left;margin-top:2px;border: none;width: 90%; float: left;">
				<a class="mui-icon mui-icon-search" style="position: absolute;left:8%;line-height: 45px;color: #999" id="search"></a>
			</div>	
			<!-- 正常时候显示的部分 -->
			<div class="normal">
				<div class="mui-content-padded" style="height: 44px;padding: 5px 10px; display: inline;">
					<!-- <a class="mui-pull-left" style="color: #EA4F16;"> 
						<span class="mui-icon mui-icon-compose" id="touchchange" style="margin-left: 24px;padding-bottom: 10px;margin-top:2px;"></span>
					</a> 
					<a class="mui-pull-right" style="color: #EA4F16;">
						<span id="addStore" class="mui-icon mui-icon-plusempty" style="margin-right:24px;padding-bottom: 10px;margin-top:2px;"></span>
					</a> -->
				</div>
			</div>
			<!-- 当点击修改时候这部分出现 -->
			<div class="changepage">
				<!-- <div class="mui-content"
					style="padding: 10px; height: 44px; border-bottom: 1px solid #e2dfdf;">
					<a class="mui-pull-left" id="successchange" style="color: #EA4F16;padding-left: 5px;">完成</a> <a
						id='confirmdelete' class="mui-pull-right"
						style="color: #EA4F16; margin-left: 10px;">删除</a> 
						<a
						id='confirmdisabled' class="mui-pull-right"
						style="color: #EA4F16;">停用</a>
					<div id="info"></div>
				</div> -->
			</div>	
			</div>	
				 <div class="mui-content" style="clear: both;overflow: auto; margin-top:135px;">
				 	<!-- <div class="mui-table-view-cell mui-checkbox mui-left alltouch" style="display: none;"  id="all-check">
						<input name="checkbox" type="checkbox" >全选
					</div> -->
					<ul class="mui-table-view" id="storeLists">
					<!--<li class="mui-table-view-cell">众赏旗舰店1<a
							class="mui-navigate-right">  </a></li> 
						<li class="mui-table-view-cell"><a
							class="mui-navigate-right"> 众赏旗舰店2 </a></li>
						<li class="mui-table-view-cell"><a
							class="mui-navigate-right"> 众赏旗舰店3 </a></li>
						<li class="mui-table-view-cell"><a
							class="mui-navigate-right"> 众赏旗舰店4 </a></li> -->
					</ul>
				</div>	
			</div>		
		<!-- tab1 end -->
	</div>	
	<!-- <footer class="mui-bar mui-bar-tab me-menu">
		<div  class="mui-tab-item active mui-active" id="storeManage"><span class="mui-icon iconfont icon-storemanage"></span>
				<span class="mui-tab-label">店铺管理</span></div>
		<div class="mui-tab-item" id="merInfo"><span class="mui-icon iconfont icon-machantsnotes"></span>
				<span class="mui-tab-label">商户信息</span></div>
	</footer> -->
	

</body>
<script src="${basepath}/assets/plugin/require.js"></script>
<script type="text/javascript"
	src="${basepath}/assets/def/js/tips/tips.js"></script>

<script src="${basepath}/assets/plugin/mui/dist/js/mui.min.js"></script>
<script src="${basepath}/assets/plugin/mui/js/mui.picker.js"></script>
<script src="${basepath}/assets/plugin/mui/js/mui.poppicker.js"></script>
 <script type="text/javascript"
			src="${basepath}/views/template/web/tips/merchants/def/manage.js?v=9432424234234388"></script>
			
<script type="text/javascript">
var parentCode = '';
var basePath = "${basepath}/views/template/web/";
var empId = "${loginVo.empId}";
<#if param??>
	parentCode = '${param.data}';
</#if>

//if(parentCode != null){
//	localStorage.removeItem("_parent_code");	
//}
 /* var Manage = {

		orgCode:null,
		init:function(){
			//alert(4);

			require([ "jquery", "mui", "mui_view", "addr", "common", "ftscroller" ],
					function($$, mui, mui_view, addr, tools) {
				Manage.buildMerchantsInfoSel(addr);

				Manage.initStoreLitenters(addr,$$,tools);
				
			});
		},
		//店铺功能相关事件
		initStoreLitenters:function(addr,$$,tools){
			//搜索店铺
			mui("body").on('tap', '#search', function() {
				//更新状态
				Manage.buildStore(addr,Manage.orgCode);
				Manage.buildOrg(addr,Manage.orgCode,Manage.schema);
			});
			//选择商户
			mui("body").on('change', '#merchantsInfo', function() {
				var me = $(this);
				//记录店铺
				Manage.orgCode = me.val();
				var me = $(this);
				//记录店铺
				var parentCode = me.val();
				//记录店铺
				var schema = Manage.schema = me.children('option:selected').attr("data-schema");
				//更新状态
				Manage.buildStore(addr,parentCode);
				Manage.buildOrg(addr,parentCode,schema);
				
			});
			//单选按钮被覆盖，所以事件添加到父级节点		
			mui("body").on('tap', 'li.mui-table-view-cell', function() {
				var type = $(this).attr("data-type");
				var code = $(this).attr("data-code");
				localStorage.setItem("_parent_code",code);
				//区域
				if(type == '1'){
					window.location.href = "${basepath}/views/template/web/tips_merchants_orgmanage.xhtml?param.data="+code;	
				//店铺
				}else{
					window.localStorage.setItem("empId", "${loginVo.empId}");
					window.localStorage.setItem("storeId", Manage.getStoreId($(this)));
					window.localStorage.setItem("tip_orgCode",parentCode);
					window.location.href = "${basepath}/views/template/web/tips_store_sub_storeinfo.xhtml";	
					
					//localStorage.setItem("_storeId",Manage.getStoreId($(this)));
					//localStorage.setItem("_orgCode",Manage.orgCode);
					//window.location.href = "tips_store_addStore.xhtml";						
				}
			});
		},
		getStoreId:function(li){
			var a = li.children("a")[0];
			var storeId = $(a).attr("data");
			return storeId;
		},
		/**
		 * 构建商户
		*
		buildMerchantsInfoSel:function(addr){
			//var tools = require("common");
			//var loading=tools.loading();
			$("#merchantsInfo").html("");
			// 初始化单页view
			addr.findMerchantsInfoEntity(
					"status=2",
					function(datas) {
						datas = datas.resultData.body.result;
						len = datas.length;
						//不是区域经理
						if(len == 0){
							window.location.href = '${basepath}/views/template/web/tips_merchants_assistant.xhtml';	
						}
						//loading.close();
						var orgCode ;
						var schema ;
						$("#merchantsInfo").html();
						//alert(1);
						for (var i = 0; i < len; i++) {
							var da = datas[i];
							if(da.schema != da.orgCode){
								////记录所有的商户
								$("#merchantsInfo").append('<option value="' + da.orgCode + '" data-schema="'+da.schema+'">' + da.orgName+ '</option>');
								if(orgCode == null){ 
									schema = da.schema;
									orgCode = da.orgCode;
								}
							}
						}
						
						//构建门店、区域列表
						Manage.orgCode = orgCode;
						Manage.schema = schema;
						//只有商户
						if(schema == null || schema == 'undefined'){
							window.location.href = '${basepath}/views/template/web/tips_merchants_assistant.xhtml';						
						}
						$('body').show();
						if(parentCode==''){
							parentCode = orgCode;
						}
						Manage.buildStore(addr,parentCode);
						Manage.buildOrg(addr,parentCode,schema);
						//加载完成后加载商户信息
						//Manage.showMerDatas();
				});	
		},
		/**
		 * 构建下级区域
		 *
		buildOrg:function(addr,parentCode,schema){
			var url = addr.mercants.getListByParentCode;	
			var datastr=JSON.stringify({parentCode:parentCode,schema:schema,orgName:$("#searchVal").val()});
			addr.ajaxJson(url,datastr,function(data){
				if(data!=null&&data.resultMessage.messageCode=="0000"){
					data = data.resultData.body.result;	
					Manage.buildDatas(data);
				}				
			});
		},
		/**
		 * 构建门店
		 *
		buildStore:function(addr,orgCode){
			$("#storeLists").html("");
			//addr.searchStoreListByOpenId(
			var url = addr.mercants.searchStoreByParentCode;	
			var datastr=JSON.stringify({orgCode:orgCode,storeName:$("#searchVal").val()});
			
			addr.ajaxJson(url,datastr,
				function(datas) {
					datas = datas.resultData.body.result;						
					Manage.buildDatas(datas);
				});
			
		},
		buildDatas:function(datas){

			var isAdd = false;
			for (var i = 0; i < datas.length; i++) {
				var da = datas[i];
				var status = da.storeStatus ;
				var name = da.storeName?da.storeName:da.orgName;
				var id = da.storeId?da.storeId:da.orgId;
				var code = da.orgCode?da.orgCode:da.orgId;
				
				var type = da.storeId?0:1;
				if(status == 3){
					continue;
				}
				var showVal="",storeName;
				if(da.storeStatus == 2){
					storeName ="<span style='color: lightgray;'>"+name+"</span>" ;
				}else{
					storeName ="<span >"+name+"</span>" ;
				}
				////记录所有的商户
				if(Manage.status=='edit'){

					if(da.storeStatus == 2){
						showVal += "<span class='store_name_status_edit'>启用</span>";
					}
//					/<li class="mui-table-view-cell mui-checkbox mui-left" name="checkbox"><input name="checkbox" type="checkbox" style=""><a class="store_li" data="32" style="margin: -11px -50px;"> 1111 </a></li>
					var li = $('<li class="mui-table-view-cell mui-checkbox mui-left"  name="checkbox"></li>');
					li.append('<input name="checkbox" type="checkbox" class="manage_checkbox" data-type="'+type+'" data-code="'+code+'"/>');
					var a = $('<a style="margin: -11px -50px;" class="store_li" data="'+id+'">'+storeName+' </a>');
					li.append(showVal);
					li.append(a);
					if(type==0){
						$("#storeLists").append(li);
					}else{
						$("#storeLists").prepend(li);
					}
				}else{

					if(da.storeStatus == 2){
						showVal += "<span class='store_name_status'>已停用</span>";
					}
					var li = $('<li class="mui-table-view-cell" data-type="'+type+'" data-code="'+code+'"></li>');
					li.append('<input name="checkbox" type="checkbox" class="manage_checkbox" style="display: none"/>');
					var a = $('<a class="mui-navigate-right store_li" data="'+id+'">'+storeName+'</a>');
					li.append(showVal);
					li.append(a);
					if(type==0){
						$("#storeLists").append(li);
					}else{
						$("#storeLists").prepend(li);
					}
				}			
			}
			
		}
}  */
 Manage.initAreaMer();
</script>	
</html>













