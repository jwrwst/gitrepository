<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.rp.services.qrcodeinfo.core.dao.ItQrcodeInfoDAO">
    
    <resultMap type="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItQrcodeInfoEntity" id="itQrcodeInfoEntity">
       	<result column="qrcode" property="qrcode" />
       	<result column="store_id" property="storeId" />
       	<result column="store_name" property="storeName" />
       	<result column="emp_id" property="empId" />
		<result column="order_num" property="orderNum" />
		<result column="state" property="state" />
		<result column="update_time" property="updateTime" />		
    </resultMap>
     
    <insert id="save" parameterType="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItQrcodeInfoEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO it_qrcode_info (qrcode,store_id,order_num,state,update_time)
        VALUES (#{qrcode}, #{storeId}, #{orderNum},#{state},#{updateTime})

    </insert>
    
    <update id="update" parameterType="com.platform.rp.services.qrcodeinfo.core.dao.entity.ItQrcodeInfoEntity">
        update it_qrcode_info 
        <set>
            <if test="empId != 0 and empId !=null">
                emp_id = #{empId},
            </if>
            <if test="state != 0 and state !=null">
                state = #{state},
            </if>
            <if test="updateTime !='' and updateTime !=null">
                update_time = #{updateTime},
            </if>
        </set>
        where 
         1=1
         <if test="qrcode != '' and qrcode != null ">
          	  and qrcode = #{qrcode}
         </if>
         <if test="storeId != 0 and storeId != null ">
              and store_id = #{storeId} 
          </if>
    </update>
    
    <select id="getByQrcode" resultMap="itQrcodeInfoEntity">
         select s.*,b.store_name from it_qrcode_info s left join bs_store_info b on s.store_id =  b.store_id   
         <where>
             s.qrcode = #{qrcode} and b.status = 1
             <if test="storeId != 0 and storeId != null ">
                 and s.store_id = #{storeId} 
             </if>
             
         </where>  
        
    </select>
    
    <select id="getListByOrderNum" resultMap="itQrcodeInfoEntity" parameterType="string">
         select * from it_qrcode_info s     
         <where>
             order_num = #{orderNum}            
         </where>          
    </select>
    
  
</mapper>