<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.rp.services.organize.core.dao.BsMerchantsEmployeeDAO">
    
    <resultMap type="com.platform.rp.services.organize.core.dao.entity.BsMerchantsEmployeeEntity" id="bsMerchantsEmployeeEntity">
        <result column="id" property="id" />
        <result column="org_code" property="orgCode" />
        <result column="org_name" property="orgName" />
       	<result column="emp_id" property="empId" />
       	<result column="name" property="empName" />
		<result column="update_time" property="updateTime" />
		<result column="job_number" property="jobNumber" />
    </resultMap>
    
    <sql id="page">
		<if test="start > -1">
			<if test="pageSize > 0">
				limit #{start}, #{pageSize}
			</if>
			<if test="pageSize == 0 or pageSize == '' or pageSize &lt; 0">
				limit #{start}
			</if>
		</if>
	</sql>
    
    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="com.platform.rp.services.organize.core.dao.entity.BsMerchantsEmployeeEntity">
		insert into bs_merchants_employee(org_code,emp_id,update_time,status)
		values(#{orgCode},#{empId},#{updateTime},#{status})
	</insert>
	
    <delete id="deleteByOrgCodeAndEmpId">
        delete from  bs_merchants_employee where  org_code = #{orgCode} and emp_id = #{empId}      
    </delete>
	
      
    <select id="getlist" resultMap="bsMerchantsEmployeeEntity" parameterType="string">
         select t.*,b.name from bs_merchants_employee t left join bs_employee_info b on t.emp_id = b.emp_id
         <where>            
                t.org_code = #{orgCode}          
         </where>         
    </select>
    
    <select id="getListByEmpId" resultMap="bsMerchantsEmployeeEntity" parameterType="long">
         select t.*,b.name from bs_merchants_employee t left join bs_employee_info b on t.emp_id = b.emp_id left join bs_organize c on t.org_code = c.org_code
         <where>            
                t.emp_id = #{empId}  and c.schema = #{schema}       
         </where>         
    </select>
    
    <select id="getMerchantsListByEmpId" resultMap="bsMerchantsEmployeeEntity" parameterType="long">
         select t.*,b.name,c.org_name from bs_merchants_employee t left join bs_employee_info b on t.emp_id = b.emp_id
         left join bs_organize c on t.org_code = c.org_code
         <where>            
                t.emp_id = #{empId}   and  c.parent_code = '0'  and  c.status = 2
         </where>         
    </select>
    
    <select id="getPage" resultMap="bsMerchantsEmployeeEntity" parameterType="map">
         select t.*,b.name,b.job_number from bs_merchants_employee t left join bs_employee_info b on t.emp_id = b.emp_id
         <where>            
                t.org_code = #{orgCode}          
         </where>
         <include refid="page" />         
     </select>
    
 	 <select id="count"  resultType="int" parameterType="map">
         select count(1) from bs_merchants_employee t 
         <where>            
                t.org_code = #{orgCode}          
         </where>     
     </select>
     
 	  <select id="getAllEmployee" resultMap="bsMerchantsEmployeeEntity" parameterType="string">
         select t.*,b.name from bs_merchants_employee t left join bs_employee_info b on t.emp_id = b.emp_id
         <where>            
                t.org_code in (select c.org_code from bs_organize c where c.schema = #{orgCode} and c.status = 2)        
         </where> 
         group by t.emp_id
    </select>
  
    <select id="getCount" resultType="int" parameterType="string">
        SELECT
			count(1)
		FROM
			bs_merchants_employee s
		WHERE
			emp_id = #{empId}
			and org_code = #{orgCode}
		 and s.status = 1
      </select>
      
    <select id="getCountByOpenIdAndOrgCode" resultType="int" parameterType="string">
        SELECT
			count(1)
		FROM
			bs_merchants_employee s
		LEFT JOIN bs_employee_info e ON s.emp_id = e.emp_id
		WHERE
			wx_account = #{openId}
			and org_code = #{orgCode}
		 and s.status = 1
      </select>
</mapper>