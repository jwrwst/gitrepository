<!DOCTYPE html>
<html>
	  <head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <title>众赏</title>
	    <link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css" rel="stylesheet"/>
	    <link href="${basepath}/assets/def/css/tips.css" rel="stylesheet"/>
	    <link rel="shortcut icon" href="${basepath}/assets/favicon.ico" />
	    <style>
			.chart {
				height: 200px;
				margin: 0px;
				padding: 0px;
			}
			h5 {
				margin-top: 30px;
				font-weight: bold;
			}
			h5:first-child {
				margin-top: 15px;
			}
			.statis-title{
			  display:none;
			}
			.statis-placeholder{
				height:220px;
			}
			.plat-title{
			position: relative;
			}

		</style>
	  </head>
	  
	  <body>
	  	  	
	    <!--页面主结构开始-->
		<div id="center" class="mui-views">
			<div class="mui-view">	
			    <div class="mui-navbar">
				</div>	
				<div class="mui-pages">
				</div>
			</div>
		</div>	
	     
	    <!-- 列表  -->
		<div id="regpage" >		
		  <!--页面标题栏开始-->
		  <div class="mui-bar mui-bar-nav" style='padding:0; display:block;'>
		<span class='mui-pull-left'> <span
			class="mui-icon iconfont icon-xiala"
			style="position: absolute; left: 100px; top: 0; color: #ea4f16; font-size: 12px !important;"></span>
			<select class="mui-btn mui-btn-block mui-pull-right"
			style="width: 112px; padding-right:20px; background: transparent; display: block; position: absolute; left: 0;"
			name="merchantsInfo" id="merchantsInfo">
		</select>
		</span>
		<p
			style="float: right; font-size: 14px; margin:0 10px 0 0; line-height: 44px; color: #EA4F16;"
			id="userInfo">账户与安全</p>
			<div class="storeevalute storrank " style='margin-top:44px; width:100%;'>
			<span class="mui-pull-right"
				style='width: 80px; max-width:20%; margin-right:10px; display:inline-block; position: relative;'>
				<span class="mui-icon iconfont icon-xiala"
				style="position: absolute; right: 0; top: 5px; color: #fff; font-size: 12px !important;"></span>
				<select class="mui-btn mui-pull-right"
				style="width: 80px; color: #fff; background: transparent; padding-right: 20px;"
				name="dateType" id="dateType">
				<!-- 	<option value="0">按天</option> -->
					<option value="1">按周</option>
					<option value="2">按月</option>
					<option value="3">按年</option>
					<option value="4">自定义</option>
			</select>
			</span>
			           <!-- 显示自定义日期开始 -->
				<button type="button" class="mui-btn mui-btn-outlined" id="dateWindow-disTime" 
				 style='display:none;'>
					<span class="custom-date-val" id="disStartTime" data-val=""></span>至
					<span class="custom-date-val" id="disEndTime" data-val=""></span>
				</button>
				<!-- 显示自定义日期结束 -->

			<div class="swiper-container">
				<div class="swiper-wrapper" id="showDataView">
					
				</div>
				<!-- Add Arrows -->
				<div class="swiper-button-next mui-icon iconfont icon-next"></div>
				<div class="swiper-button-prev mui-icon iconfont icon-prev"></div>
			</div>

		</div>
	</div> 
		  <div class="mui-page-content mui-content"  id="scroll-content" style='margin-top:156px; width:100%;'>

	 
		  	<div class="scroller">		  		
		  		<div class="plat-content">
		  			<div class="charts-container" id="template-charts-content">
		  				
					</div>			
				</div>
				<!-- 页面底部标题 -->
			</div>
		  </div>		
            
		</div>
<!-- 弹出自定义日期开始 -->
	<div class="dateWindow" id="customDate" style='display:none;'>
		<div
			style="width: 100%; position: absolute; top: 0; height:194px; background: white; z-index: 99999;">
			<div class="mui-content-padded tips-reginfo-submit"
				style="margin: 30px 5%;">
				<input type="date" id="customStartTime" class="mui-input-clear date"
					placeholder="请选择时间"
					style="border: 1px solid #EA4F16; text-align: center; width: 45%; margin-left: 3%; padding:10px 5px; margin-right: 3%;">
				<input type="date" id="customEndTime" class="mui-input-clear date"
					placeholder="请选择时间"
					style="border: 1px solid #EA4F16; text-align: center; width: 45%; padding:10px 5px;">
				<button type="button" id="customDateSubmit"
					class="mui-btn mui-btn-warning mui-btn-block customerDate"
					style="margin-top: 10px; width: 94%; margin-left: 3%;">确定</button>
			</div>
		</div>
		<div
			style="width: 100%; height: 100%; position: absolute; top: 45px; background: rgba(0, 0, 0, 0.3); z-index: 99998;">
		</div>
	</div>
	<!-- 弹出自定义日期结束 -->		
	  [#include 'nav.html']
	  </body>

    
     <script src="${basepath}/assets/plugin/echarts-m/dist/echarts.js"></script>
	 <script type="text/javascript" src="${basepath}/assets/def/js/tips/tips.js"></script>	
	 
	 
	  <script type="text/javascript"
			src="${basepath}/views/template/web/tips/merchants/manage/def/manage.js?v=94324242355534389"></script> 
	 <script type="text/template" id="template-charts">
			{{#each data}}
				<div id="chartsObj{{@index}}" class="statis-placeholder"></div>
			{{/each}}
	 </script>
	
	 <script type="text/javascript">
		var navType = 'statistics';
		var basePath = '';
		var empId = "${loginVo.empId}";
		//0：商户   1 区域
		Manage.type =  ${type};
		
	 	//var storeId = window.localStorage.getItem("storeId");
		// 使用
        require(
            [
                'echarts','addr',
                'echarts/chart/line' ,// 使用柱状图就加载bar模块，按需加载
                'mui','mui_view','jquery','template7'
            ],
            function (ec,addr,tools) {
            	var viewApi = mui('#center').view({
			  		defaultPage: '#regpage'
			    });
	            	//图形定义参数                    				
					var option = {
							backgroundColor:"#ffffff",
							title:{
								show:true,
								padding:10,
								textStyle:{
									fontSize:15
								}
							},
						    tooltip : {
						    	show:true,
						        trigger: 'item',
						        formatter:"{b} : {c}",
						        backgroundColor: 'rgba(255,78, 0,0.7)',
						        borderColor: '#333',
						        borderRadius: 4,
						        borderWidth: 0
						    },					   
						    toolbox: {
						        show : false,
						        feature : {
						            mark : {show: true},
						            dataView : {show: true, readOnly: false},
						            saveAsImage : {show: true}
						        }
						    },
						    calculable : false,
						    xAxis : [
						        {
						            type : 'category',
	// 					            boundaryGap : false,
						            data:[]
						        }
						    ],
						    yAxis : [
						        {
						            type : 'value'
						        }
						    ],
						    series : [
						        {	
						        	name:"",
						            type:'line',
	// 					            markPoint : {
	// 					                data : [
	// 					                    {type : 'max', name: '最大值'},
	// 					                    {type : 'min', name: '最小值'}
	// 					                ]
	// 					            },
						            itemStyle: {
						                normal: {
						                    color: 'tomato',
						                    barBorderColor: 'tomato',
						                    barBorderWidth: 6,
						                    barBorderRadius:0,
						                    label : {
						                        show: true, position: 'top',textStyle:{color:"#000"}
						                    }
						                }
						            },
						            data:[]
						        }
						    ]
					};
	        		
	            	
	                /**
					var response ={data:[{title:"服务评级",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]},
	            	                     {title:"评价人数",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]},
	            	                     {title:"评价分布",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]},
	            	                     {title:"打赏次数",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]},
	            	                     {title:"打赏金额",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]},
	            	                     {title:"收到打赏店员数",rows:['周一','周二','周三','周四','周五','周六','周日'],data:[120, 132, 101, 134, 90, 230, 210]}]};
					**/
					var chartArr=[];
	                var url = addr.store.getStoreStatisticInfoByOrgCode;

	                var isload = false;
	                //加载完商户调用
					Manage.MerSelLitenter  = function(){
	                	if(isload){
	                		return;
	                	}
	                	isload = true;
	                	setTimeout(function(){
	                		isload = false;
	                	},1000);
	                	console.debug("Manage.orgCode1:"+Manage.orgCode);

		                var param = "orgCode="+Manage.orgCode+"&startTime="+Ranking.data.startdata+"&endTime="+Ranking.data.enddata;
		                addr.getJson(url,param,function(data){	
		                	isload = false;
		                	 if(data!=null&&data.resultMessage.messageCode=="0000"){
		                		 var jsondata= data.resultData.body.result;
		                		 var response ={data:jsondata};
		                		 
		                		//添加容器            	
		                     	var template = document.getElementById('template-charts').innerHTML;
		           			    var compiled = Template7(template).compile();
		           			    var compiledRendered = compiled(response);
		           			    $("#template-charts-content").html(compiledRendered);
		           			    $(".statis-placeholder").width($("body").width()); 
		           			    
		           			    // 基于准备好的dom，初始化echarts图表        				
		        				for(var i=0;i<response.data.length;i++){					
		        					var tempObj = response.data[i];        					
		        	                var charts = ec.init(document.getElementById('chartsObj'+i)); 
		        	                option.title.text=tempObj.title;
		        	                option.xAxis[0].data=tempObj.rows;
		        	                option.series[0].data=tempObj.data;
		        	                
		        	                charts.setOption(option);
		        	                chartArr.push(charts);
		        				}
		                	 }
		                });		

	                }
					//改变统计周期
					//$("#dateType").on("change",function(t){
					//addr.getStoreStatisticInfoByStoreID("storeId="+storeId+"&filter="+$("#dateType").val(),function(data){
					Ranking.reLoad = function(){
					
						if(Manage.orgCode == null){
							return;
						}
	                	if(isload){
	                		return;
	                	}
	                	isload = true;
	                	setTimeout(function(){
	                		isload = false;
	                	},1000);
	                	console.debug("Manage.orgCode2:"+Manage.orgCode);
						var param = "orgCode="+Manage.orgCode+"&startTime="+Ranking.data.startdata+"&endTime="+Ranking.data.enddata;
			            addr.getJson(url,param,function(data){	
							if(data!=null&&data.resultMessage.messageCode=="0000"){
		                		var jsondata= data.resultData.body.result;
		                		var response1 ={data:jsondata};	var response ={data:jsondata};
		                		 
		                		//添加容器            	
		                     	var template = document.getElementById('template-charts').innerHTML;
		           			    var compiled = Template7(template).compile();
		           			    var compiledRendered = compiled(response);
		           			    $("#template-charts-content").html(compiledRendered);
		           			    $(".statis-placeholder").width($("body").width()); 
		           			    
		           			    // 基于准备好的dom，初始化echarts图表        								
								for(var i=0;i<response1.data.length;i++){
									var tempObj = response1.data[i];
									var charts = ec.init(document.getElementById('chartsObj'+i));
	// 								charts.showLoading();
	// 								setTimeout(function(){charts.hideLoading();}, 500);
									option.title.text=tempObj.title;
					                option.xAxis[0].data=tempObj.rows;
					                option.series[0].data=tempObj.data;
					                charts.setOption(option);
								}
		                	 }
		               	 
		               });		
						
					};


					//区域经理直接进来移除
					if(parentCode == ""){
						localStorage.removeItem("isMerManage");
					}
					Manage.isMerManage = localStorage.getItem("isMerManage"),
					Manage.buildMerchantsInfoSel(addr);
					
					//初奴化数据
					Ranking.unLoad = true;
					Manage.initCommontListenters(addr);

					Ranking.initListenter(addr);
					Ranking.initList(addr);
					//默认设置显示每周
					Ranking.initData(1);
            }
        );
		
		
		
		
    </script>
	  <!-- 打赏列表模板 -->
	  <!--  时间切换开始 -->
<script src="${basepath}/assets/plugin/swiper.min.js"></script>

<!-- Initialize Swiper -->
<script>
    var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        paginationClickable: true,
        nextButton: '.swiper-button-next',
        prevButton: '.swiper-button-prev',
        spaceBetween: 30,
        onSlideChangeEnd:Ranking.onSlideChangeEnd
       // onSlideChangeEnd:function(){ }
    }); 
    </script>
    
     
    <!--  时间切换结束 -->
</html>			