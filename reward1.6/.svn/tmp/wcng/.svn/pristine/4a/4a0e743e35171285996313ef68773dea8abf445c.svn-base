<!DOCTYPE html>
<html>
	  <head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <title>众赏</title>
	    <link href="${basepath}/assets/plugin/mui/dist/css/mui.min.css" rel="stylesheet"/>
	    <link href="${basepath}/assets/def/css/tips.css" rel="stylesheet"/>
	    <link href="${basepath}/assets/def/css/axis.css" rel="stylesheet"/>
	    <link rel="shortcut icon" href="${basepath}/assets/favicon.ico" />
	    <style type="text/css">
			.line-border-right{
		       border-right:1px solid #cccccc;
		    }

		    .mui-table-view-cell{
		       padding-bottom:5px;
		    }
		    .em{ 
		       position:relative; 
		       left:-30px; 
		       top:0px;
		       width:20px; 
		       height:20px;
		       font-size:20px;
		       color:#ffffff;
		       
		    }
		    .mui-icon-star{
		    	font-size:12px!important;
		    }
		    
		    .bignum{
		    	font-size:18px;
		    }
		   

		  
	    </style>
	  </head>
	  
	  <body> 	  	
	    <!--页面主结构开始-->
		<div id="center" class="mui-views">
			<div class="mui-view">	
			    <div class="mui-navbar">
				</div>	
				<div class="mui-pages">
				</div>
			</div>
		</div>	
	     
    	<!-- 纪录详情 -->
		<div id="pagedetails" class="mui-page" >		
		  <!--页面标题栏开始-->
		  <div class="mui-navbar-inner mui-bar mui-bar-nav">
		      <span class="mui-pull-left">		           						
  					<button class="mui-action-back mui-btn mui-btn-link mui-btn-nav mui-pull-left" style="color:#000000"><span class="mui-icon mui-icon-left-nav" style="color:#ff4e00"></span>返回排行</button>	
		      </span>			 		
			
		  </div>
		  <div class="mui-page-content"  id="scroll-content">
		   <div class="scroller">
		  		<div class="plat-content" id="template-content">		  		       
		  				<ul class="mui-table-view mui-grid-view mui-grid-4" style="padding:10px;">
			  				<li class="mui-table-view-cell mui-media mui-col-xs-12 mui-col-sm-12 empnickname">
				                   		
				            </li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4 line-border-right">
				                    <div class="bignum daydata">0</div>
				                    <span class="">今日打赏</span>
				            </li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4 line-border-right">
				                    <div class="bignum weekdata">0</div>
				                    <span class="">本周打赏</span>
				            </li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-4" >
				                    <div class="bignum monthdata">0</div>
				                    <span class="">本月打赏</span>
				            </li>
		  				</ul>	  				
			  			 <!-- 有纪录 -->			       		  			
		  				<div class="content">
						  <div class="wrapper">
						    <div class="main">
						      <hr>
						      <div class="year">				        
						        <div class="list">
						          <!--template-pagedetails-li  -->
						          <ul class="" id="template-pagedetails-li-content"> 
						          </ul>
					            </div>
					          </div>     
					     	</div>
					      </div>
						</div>		
						
				</div>
				
			</div>					
		  </div>	     

		</div>
		
	  [#include '../model/menu.html']
	  </body>
	  <script src="${basepath}/assets/plugin/require.js"></script>
	  <script type="text/javascript" src="${basepath}/assets/def/js/tips/tips.js"></script>
 
	 <script type="text/template" id="template-pagedetails-li">   
			{{#each data}} 
				{{if_date date}}	        	          
				<li class="cls">				              
					<p class="intro">
					      <span class="mui-icon iconfont icon-tips"></span>					                
					</p>	
					<span class="intro-text">收到了{{rankData}}元小费</span> 	
					<div class="intro-time">{{time}}</div>	      		              
					<div class="more">
					   {{remark}}
					</div>
				</li>
			

			{{/each}}		  			
  	  </script>	 
  	  <script type="text/javascript">
  	  require(["template7"],function(template7){	  
		  //打赏纪录日期分组
		  Template7.registerHelper('if_date', function (date, options){	
			  if(Template7.global.dateArr==null){
				  Template7.global.dateArr = [];
			  }			  
			  var ret = '';
			  if(Template7.global.dateArr.indexOf(date) < 0 ){
				  ret = '<li class="clsdt">' +
				              '<span class="mui-icon iconfont icon-circle"></span>' +
				              '<span class="intro-text">'+date+'</span> ' +		                
				            '</li>';			  
				  Template7.global.dateArr.push(date);
			  }
			  return ret;
			});
  	  });
  	  </script> 
	  
  	  
  	  
	  <script type="text/javascript">
	  require(["jquery","mui","mui_view","template7","addr","common","ftscroller"],function($$,M,mui_view,template7,addr,tools){
		  Template7.global = {};
		  Template7.global.tools=tools;
		  //初始化单页view
		  var viewApi = mui('#center').view({
		  		defaultPage: '#pagedetails'
		  });
		  
		  $$(document).ready(function(){
        	  	  //加载基础数据
        	  	  var empId = window.localStorage.getItem("range-empId");
		          var storeId = window.localStorage.getItem("range-storeId");
				  addr.getEmployeeRewardRankDetail("storeId="+storeId+"&empId="+empId,function(data){
					  if(data!=null&&data.resultMessage.messageCode=="0000"){
						  var jsondata = data.resultData.body.result;
						  //daydata: 1.01empnickname: "hellohello"jobnumber: "666666"monthdata: 1.01weekdata: 1.01
						  $$(".empnickname").html((jsondata.empnickname||"")+"(编号:"+(jsondata.jobnumber||"")+")");
						  $$(".daydata").html(jsondata.daydata||0);
						  $$(".weekdata").html(jsondata.weekdata||0);
						  $$(".monthdata").html(jsondata.monthdata||0);					  
						  
					  }
				  });		  

				  //加载详情列表数据					  
				  loaddata();				  
				  
     		  
			  
		  });
		  
	  });
	  
	  
	  //加载排行列表数据
	  var pageNo=1;
	  var loaddata = function(){ 
		  var addr = require("addr");
		  var tools = require("common");
		  var filter = window.localStorage.getItem("dateType");
		  var empId = window.localStorage.getItem("range-empId");
		  var storeId = window.localStorage.getItem("range-storeId");
		  var startTime = window.localStorage.getItem("range-startTime");
		  var endTime = window.localStorage.getItem("range-endTime");
		  
		  var json={"numPerPage":20,"storeId":storeId,"pageNum":pageNo,"querytype":"empReward","filter":filter,"empId":empId,"startTime":startTime,"endTime":endTime};
		  
		  if(tools.global.detail==null){tools.global.detail={};}
		  if(pageNo> (tools.global.detail.totalPages)){
			  return;
		  }
		  
		  addr.toRewardDetailListPage(JSON.stringify(json),function(data){
			  if(data!=null&&data.resultMessage.messageCode=="0000" &&
				  data.resultData.body.result!=null&&data.resultData.body.result.result.length!=0){
				  
				  var template = document.getElementById('template-pagedetails-li').innerHTML;				  
				  var compiled = Template7(template).compile();
				  var arrData = data.resultData.body.result.result;
			
				  var compiledRendered = compiled({data:arrData});

				  jQuery("#template-pagedetails-li-content").append(compiledRendered);
				  
				  pageNo++;
				  tools.global.detail.totalPages = data.resultData.body.result.totalPages;				 
			  }
			  
			  //没有纪录
			  try{
				  if(data.resultData.body.result.totalPages==0){
					  jQuery(".norecord").show();
				  }
			  }catch(e){jQuery(".norecord").show();}
			  
			  tools.scroller.refresh() ;
			  
		  });
	  }
	  
	


	  

	  </script>
</html>			